\section{Introduction}
Throughout the years, a lot of efforts were spent to study and derive the laws that govern the motion of a pendulum. \\
In many classical experiments, an observer measures directly the necessary physical quantities in order to estimate some other ones. \\
In our setting, We used an STM32F4Discovery (from now simply Discovery) board that, together with its sensors and an algorithm, it is able to compute directly and provide to the observer the requested results while the experiment is performed. \\
The Discovery board is an electronic device equipped with an ARM CortexM4 microcontroller and various on-board devices. For this project, we used the LIS3DSH accelerometer that measures accelerations of the board in the three axes, and a serial port that enables communication between the board and a Personal Computer that eventually displays the results. \\

\subsection{Problem statement}
A pendulum it is a well studied physical system in which a weight is suspended from a pivot and it is able to oscillate freely. It is often difficult to find exact solutions in the general case so usually, some assumptions are made in order to make the problem easier to model and solve. \\
In our case we model the setting as a simple gravity pendulum, i.e. We assumed that:
\begin{itemize}
	\item the rod or cord on which the bob swings is massless, inextensible and always remains taut,
	\item the bob is a point mass,
	\item motion occurs only in two dimensions,
	\item the gravitational field is uniform,
	\item the support does not move.
\end{itemize}
It is trivial to map the abstract case with our concrete one, in particular, the Discovery board is our bob and the USB cable is the rod. \\
The aim of the project is to estimate the length of the cable while the board oscillates.
\subsection{Summary of the work}
Our work can be divided in three distinct phases:
\begin{itemize}
	\item we analyzed the datasheet of on-board accelerometer and developed a driver that it is able to interact with it while exposing a high-level interface that simplified interaction,
	\item we derived the mathematical model of the physical system in order to be able to separate between variables that we can measure and the unknown that we should compute,
	\item we put all together by means of an algorithm coupled with some parameter tuning and complementary solutions as a result of various experiments. 
\end{itemize}
\pagebreak

\section{Design and implementation}
\textbf{Maybe the following text should be inserted in "summary of the work"}

We drafted the algorithm to calculate the length of the wire. We decided to implement this algorithm in a raw simulator built by us in Javascript \cite{javascriptPrototype}. Then we developed it in MIOSIX.\\
We will see the mathematical model, how to calculate the data we need ($\theta_{max}$ and period) using raw data obtained by the accelerometer and how to filter and clean raw data.

\subsection{Mathematical Model}
We did not considered the friction (since it is to complex to calculate), so the period of the gravity pendulum has the following series as period formula: 
$$T = 2 \pi \sqrt{\frac{L}{g}} \left(1 + \frac{1}{16} \theta_0^2 + \frac{11}{3072} \theta_0^4 + ...\right)$$
Stopping at the second term of the series we are able to calculate the length of the wire ($L$) using period and $\theta_0$, i.e. $\theta_{max}$ , we obtain:
$$ L = g \cdot \frac{T^2}{4 \cdot \pi^2 \cdot \left(1 + \frac{\theta_0^2}{16}\right)^2}$$
\par
We can see that if we had used only one term of the series we would not have needed to calculate the $\theta_{max}$, but of course there is an error which increases for larger amplitude. In our application we cannot afford this error since, as we will see, in fact there are other imprecisions due to measurement errors and approximations, and the experiment is conducted using large amplitude.\\
We calculated the errors according to the values obtained using 3 terms of the series in table \prettyref{tab:errors}.  

\begin{table}[H]
	\small
	\begin{center}
		
		\caption{Series errors compared with the value obtained with 3 terms}
		\begin{tabular}{l|lcc|L{2cm}l}
			Angle & Error with 1 term & Error with 2 terms\\
			\cline{1-3}
			$0$ & 0\% & 0\%\\			
			$\frac{\pi}{4}$ & 4\% & 0.1\%\\			
			$\frac{\pi}{2}$ & 14.9\% & 1.8\%\\			
			$\pi$ & 49\% & 17.7\%\\			
		\end{tabular}
		\label{tab:errors}
	\end{center}
\end{table}

Since the pendulum is moved only by the ground acceleration and the wire is not rigid the max angle of the pendulum is of $\frac{\pi}{2}$ for that value the error using 2 terms is just of 1.8\%, an acceptable value. So 2 terms are enough, as used in the previous formula.

\subsection{Calculation of Data}
Since there is friction that is not considered in our mathematical model we have to calculate period and $\theta_{max}$ in the shortest time possible, even if this means measurements errors. In fact there a single measurement or a small measurement is not so good like the one obtained by a mean of measurements, but this errors is smaller than error caused by friction. \textbf{HOW TO PROOF?}\par

We have considered only a quarter of period, we have considered every descending quarter so we measure a period every new half period (this partially solves the problems due to friction).\\
We store the min value of accelerometer for y axis, that is easily converted in an angle using:
$$angle = \frac{\pi}{2} -\arcsin\left(\min\left\lbrace1.0, \left|\frac{y}{SCALE \cdot g}\right|\right\rbrace\right)$$
The min function is used to avoid problems due to errors of accelerometer that could give values higher than 1. We used also abs since the sign is not important and this simplify everything.
Besides store this we store also the timestamps of min value of y axis.\\
We know that the max value of y axis when the pendulum is in vertical position, so when we see that the y is decrementing the pendulum is going up on the other side. So we have all data to calculate what we need.\par

The $\theta_{max}$ is given by the  angle previous calculated (angle for min value of y axis).\\
The period is given by the difference of timestamps, timestamp stored for min value of y axis and timestamp of vertical position (last position before decrementing).
Of course we recognize that we have completed period in the next tick, when we are decrementing as explained previously. So we need to keep an history of the previous timestamp to use in the calculation, in fact the previous one is the last of the period that we are going to calculate.

\subsection{Filter and Clean Raw Data}
After have made the first experiments we have seen a normal thing: the raw data obtained by accelerometer are not so good.\\
There are two main problems:
\begin{itemize}
	\item the accelerometer is not perfect and has an error
	\item the data have some pulses
\end{itemize} \par

Fortunately for the first problems the main errors are just a shift and can be resolved internally by the accelerometer setting the right OFFSETES, so we needed just to find them.\\
To do that we put the card in the two horizontal position and applied the following formula for each of both sides:
$$ offset = \frac{\left|1000-raw\_value\right|}{2}$$
then we have taken the mean of both values. \\
The values can have a little difference due to other errors not related to shift.\par

While for the second problem we decided to implement a low pass filter to filter the data, the formula used is:
$$ y_t = \alpha \cdot x_t + (1-\alpha) \cdot y_{t-1}$$
\textbf{CITE some scholar}\\
Where y is the value stored and x is the raw value.\\
Of course the higher alpha is, the more high frequency values are considered so the new value has an higher weight.

\section{Experimental evaluation}
\lipsum[1]
\subsection{Experimental setup}
\lipsum[1-2]
\subsection{Results}
%say how we have choosen alpha and other things (maybe also offsets)
%say in this chapter that for a lot of reasons the experiment is doen using large amplitude, say why

\textbf{Please make sure you explicitely cite the tables.
\prettyref{tab:a_complex_table} shows a complex table.
Please also make sure you provide each table with an exhaustive caption.
Captions for tables must be placed before not after the tables.}
\lipsum[1-4]


\begin{table}
\small
\begin{center}

\caption{Summary of the test scenarios.
$M_1\xrightarrow{\alpha}M_2$ means that an application mapping
is changed from $M_1$ to $M_2$ after application $\alpha$
has terminated.}
\begin{tabular}{l|lcc|L{2cm}l}
\cline{2-6}
& \multicolumn{3}{c|}{Description of the workload} & \multicolumn{2}{c}{Cores allocation}\\
\cline{2-6}
Name of scenario & Application & Threads & $\frac{Threads}{Cores}$ & HMP & HMP w/policy \\
\hline

\multirow{2}{*}{LITTLE 1} & ferret$\dagger$ & 1 & \multirow{2}{*}{1.00} & $0-3$ & $0$ \\
 & vips & 3 & & $0-3$ & $1-3 \xrightarrow{\dagger} 0-3$ \\
\hline
\multirow{2}{*}{LITTLE 2} & freqmine$\dagger$ & 2 & \multirow{2}{*}{1.25} & $0-3$ & $0-1$ \\
 & blackscholes & 3 &   & $0-3$ & $0-3 \xrightarrow{\dagger} 0-3$ \\
\hline
\multirow{2}{*}{LITTLE 3} & bodytrack$\dagger$ & 3 & \multirow{2}{*}{1.25} & $0-3$ & $0-1$ \\
 & facesim & 2 &  & $0-3$ & $0-3$ \\
\hline
\multirow{2}{*}{LITTLE 4} & facesim & 3 & \multirow{2}{*}{1.50} & $0-3$ & $0-1\xrightarrow{\dagger}0-3$ \\
 & blackscholes$\dagger$ & 3 &  & $0-3$ & $2-3$ \\
\hline
\hline


\multirow{2}{*}{big 1} & vips & 3 & \multirow{2}{*}{1.00} & $4-7$ & $4-5 \xrightarrow{\dagger} 4-7$ \\
 & ferret$\dagger$ & 1 & & $4-7$ & $6-7$ \\
\hline
\multirow{2}{*}{big 2} & freqmine$\dagger$ & 2 & \multirow{2}{*}{1.25} & $4-7$ & $4-5$ \\
 & blackscholes & 3 &   & $4-7$ & $6-7 \xrightarrow{\dagger} 4-7$ \\
\hline
\multirow{2}{*}{big 3} & facesim & 2 & \multirow{2}{*}{1.25} & $4-7$ & $4-5$ \\
 & bodytrack & 3 &  & $4-7$ & $4-7$ \\
\hline
\multirow{2}{*}{big 4} & facesim & 3 & \multirow{2}{*}{1.50} & $4-7$ & $4-5\xrightarrow{\dagger}4-7$ \\
 & blackscholes$\dagger$ & 3 &  & $4-7$ & $4-7$ \\
\hline

\end{tabular}
  \label{tab:a_complex_table}
\end{center}
\end{table}

\section{Conclusions and Future Works}
\lipsum[1]
